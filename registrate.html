<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Afiliado</title>
  <style>
    /* Estilos básicos */
    body { font-family: Arial, sans-serif; padding: 20px; }
    form { max-width: 500px; margin: auto; }
    input, button { display: block; width: 100%; margin: 10px 0; padding: 10px; }
    .opciones { margin: 10px 0; }
    #codigoPersonalizadoDiv { display: none; }
  </style>
</head>
<body>
  <form id="registroForm" action="https://script.google.com/macros/s/AKfycbzM1jyykVbj8k-tKV1Q7V3fgneGj_r_oUPc0e-DJF2P_dGvCK3uf70EMkusi5eNG6KV9w/exec" method="post">
  <!-- Campos de formulario -->
  <input type="text" name="nombre" placeholder="Nombre" required>
  <input type="text" name="apellido" placeholder="Apellido" required>
  <input type="email" name="email" placeholder="Email" required>
  <input type="tel" name="telefono" placeholder="Teléfono" required>
  
  <p>Seleccione el tipo de código de afiliado:</p>
  <div class="opciones">
    <label>
      <input type="radio" name="tipo_codigo" value="gratuito" required>
      Código de afiliado gratuito
    </label>
    <label>
      <input type="radio" name="tipo_codigo" value="personalizado">
      Código de afiliado personalizado
    </label>
  </div>
  
  <!-- Campo adicional para código personalizado -->
  <div id="codigoPersonalizadoDiv" style="display: none;">
    <input type="text" name="codigo_personalizado" placeholder="Código personalizado único">
  </div>
  
  <!-- Campo oculto para guardar el link de afiliado -->
  <input type="hidden" name="link_afiliado" id="link_afiliado">
  
  <button type="submit">Enviar</button>
</form>
  
  <script>
    // Función para generar un código alfanumérico aleatorio de 9 caracteres
    function generarCodigoAleatorio() {
      const caracteres = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      let codigo = '';
      for (let i = 0; i < 9; i++) {
        codigo += caracteres.charAt(Math.floor(Math.random() * caracteres.length));
      }
      return codigo;
    }
    
    // Mostrar u ocultar el input de código personalizado según la opción seleccionada
    const radios = document.getElementsByName("tipo_codigo");
    const codigoPersonalizadoDiv = document.getElementById("codigoPersonalizadoDiv");
    
    radios.forEach(radio => {
      radio.addEventListener("change", function() {
        if (this.value === "personalizado") {
          codigoPersonalizadoDiv.style.display = "block";
        } else {
          codigoPersonalizadoDiv.style.display = "none";
        }
      });
    });
    
    // Manejo del envío del formulario
    document.getElementById("registroForm").addEventListener("submit", function(event) {
      event.preventDefault(); // Prevenir el envío normal
      
      const form = event.target;
      const selectedTipo = document.querySelector('input[name="tipo_codigo"]:checked').value;
      const baseURL = "https://www.esimplyglobal.com/"; // URL base para el link de afiliado
      
      if (selectedTipo === "gratuito") {
        // Genera código aleatorio y arma el link
        const codigoAleatorio = generarCodigoAleatorio();
        document.getElementById("link_afiliado").value = baseURL + codigoAleatorio;
      } else if (selectedTipo === "personalizado") {
        // Toma el código ingresado por el usuario
        const codigoPersonalizado = form.codigo_personalizado.value;
        document.getElementById("link_afiliado").value = baseURL + codigoPersonalizado;
      }
      
      // Envía los datos del formulario usando Fetch a Google Sheets
      fetch(form.action, {
        method: form.method,
        body: new FormData(form)
      })
      .then(response => {
        if (response.ok) {
          if (selectedTipo === "personalizado") {
            // Si eligió opción personalizada, redirige al link de pago
            window.location.href = "https://mpago.la/1mpya7W";
          } else {
            // Para opción gratuita, puedes mostrar un mensaje de confirmación
            alert("Registro completado. Tu link de afiliado es: " + document.getElementById("link_afiliado").value);
          }
        } else {
          alert("Hubo un problema al enviar el formulario. Por favor, intenta nuevamente.");
        }
      })
      .catch(error => {
        console.error("Error:", error);
        alert("Error al enviar el formulario.");
      });
    });
  </script>
</body>
</html>
